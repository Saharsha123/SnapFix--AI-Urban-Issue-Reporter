<!DOCTYPE html>
<html>
<head>
    <title>Admin Reports - SnapFix</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
            min-height: 100vh; 
        }
        
        .navbar {
            background-color: #2c3e50;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .navbar h1 {
            font-size: 1.8em;
            margin: 0;
        }
        
        .nav-links {
            display: flex;
            gap: 15px;
        }
        
        .nav-links a {
            color: white;
            text-decoration: none;
            padding: 8px 15px;
            background-color: #34495e;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        
        .nav-links a:hover {
            background-color: #3498db;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
             min-height: calc(100vh - 200px);
        }
        
        h2 {
            color: #2c3e50;
            margin-bottom: 20px;
        }
        
        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .filters select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1em;
        }
        
        .filters button {
            padding: 10px 20px;
            background-color: #2ecc71;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s;
        }
        
        .filters button:hover {
            background-color: #27ae60;
        }
        
        .filters a {
            padding: 10px 20px;
            background-color: #95a5a6;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        
        .filters a:hover {
            background-color: #7f8c8d;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        table th {
            background-color: #2c3e50;
            color: white;
            padding: 12px;
            text-align: left;
            border: 1px solid #ddd;
        }
        
        table td {
            padding: 12px;
            border: 1px solid #ddd;
            text-align: left;
        }
        
        table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        table tr:hover {
            background-color: #f0f0f0;
        }
        
        a {
            color: #3498db;
            text-decoration: none;
        }
        
        a:hover {
            text-decoration: underline;
        }
        
        .assign-select {
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.95em;
        }
        
        .assign-form {
            display: inline;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.9em;
            font-weight: bold;
        }
        
        .pending {
            background-color: #f39c12;
            color: white;
        }
        
        .in-progress {
            background-color: #3498db;
            color: white;
        }
        
        .resolved {
            background-color: #2ecc71;
            color: white;
        }
    </style>
</head>
<body>
    <div class="navbar">
        <h1>SnapFix Admin Portal</h1>
        <div class="nav-links">
            <a href="{{ url_for('index') }}">üè† Home</a>
        </div>
    </div>
    
    <div class="container">
        <h2>All Reports</h2>
        
        <div class="filters">
            <form method="get" style="display: flex; gap: 15px; flex-wrap: wrap; align-items: center;">
                <select name="status">
                    <option value="">Status - All</option>
                    <option value="Pending" {% if request.args.get('status') == 'Pending' %}selected{% endif %}>Pending</option>
                    <option value="In Progress" {% if request.args.get('status') == 'In Progress' %}selected{% endif %}>In Progress</option>
                    <option value="Resolved" {% if request.args.get('status') == 'Resolved' %}selected{% endif %}>Resolved</option>
                </select>
                
                <select name="dept">
                    <option value="">Department - All</option>
                    <option value="Public Works Department (PWD)" {% if request.args.get('dept') == 'Public Works Department (PWD)' %}selected{% endif %}>PWD</option>
                    <option value="BBMP Solid Waste Management (SWM)" {% if request.args.get('dept') == 'BBMP Solid Waste Management (SWM)' %}selected{% endif %}>SWM</option>
                    <option value="BBMP Forest & Horticulture" {% if request.args.get('dept') == 'BBMP Forest & Horticulture' %}selected{% endif %}>Forest</option>
                    <option value="BESCOM" {% if request.args.get('dept') == 'BESCOM' %}selected{% endif %}>BESCOM</option>
                </select>
                
                <button type="submit">üîç Filter</button>
                <a href="{{ url_for('admin_reports') }}">‚úï Clear</a>
            </form>
        </div>
        
        <table>
            <thead>
                <tr>
                    <th>Tracking ID</th>
                    <th>Issue Type</th>
                    <th>Department</th>
                    <th>Status</th>
                    <th>Priority</th>
                    <th>Confidence</th>
                    <th>Location</th>
                    <th>Assign To</th>
                    <th>Dept Status</th>
                </tr>
            </thead>
            <tbody>
                {% if reports %}
                    {% for r in reports %}
<tr>
    <td>{{ r['tracking_id'] }}</td>
    <td>{{ r['issuetype'] }}</td>
    <td>{{ r['primary_department'] or 'N/A' }}</td>
    <td>
        <span class="status-badge {% if r['status'] == 'Pending' %}pending{% elif r['status'] == 'In Progress' %}in-progress{% else %}resolved{% endif %}">
            {{ r['status'] }}
        </span>
    </td>
    <td>{{ r['priority'] }}</td>
    <td>{{ "%.1f%%" % (r['probability'] * 100) if r['probability'] else 'N/A' }}</td>
    <td>
        {% if r['latitude'] and r['longitude'] %}
            <a href="https://www.google.com/maps?q={{ r['latitude'] }},{{ r['longitude'] }}" target="_blank">üìç Map</a>
        {% else %}
            {{ r['location'] or 'N/A' }}
        {% endif %}
    </td>
    <td>
    <span class="status-badge {% if r.dept_status == 'Assigned' %}assigned{% elif r.dept_status == 'In Progress' %}in-progress{% elif r.dept_status == 'Resolved' %}resolved{% else %}pending{% endif %}">
        {{ r.dept_status or 'Not Set' }}
    </span>
</td>
    <td>
        {% if r['tracking_id'] %}
            <form method="post" action="{{ url_for('admin_assign_report', tracking_id=r['tracking_id']) }}" class="assign-form">
                <select name="dept_admin_id" class="assign-select" onchange="this.form.submit();">
                    <option value="">Assign...</option>
                    {% for admin in dept_admins %}
                        <option value="{{ admin['id'] }}" {% if r['assigned_dept_admin_id'] == admin['id'] %}selected{% endif %}>
                            {{ admin['department'] }}
                        </option>
                    {% endfor %}
                </select>
            </form>
        {% else %}
            (no ID)
        {% endif %}
    </td>
</tr>
{% endfor %}
                {% else %}
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 20px;">No reports found</td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</body>
</html>
